<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js" integrity="sha512-zoJXRvW2gC8Z0Xo3lBbao5+AS3g6YWr5ztKqaicua11xHo+AvE1b0lT9ODgrHTmNUxeCw0Ry4BGRYZfXu70weg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            margin: 0px;
        }

        .block {
            border: 1px solid gray;
            width: 40px;
            height: 40px;
        }

        .block:hover {
            background: rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .nav {
            width: 100%;
            height: 70px;
            border-bottom: 1px solid rgb(228, 228, 228);
        }

        .playersOnline {
            font-family: Arial, Helvetica, sans-serif;
            float: right;
            margin-right: 50px;
            margin-top: 27px;
        }

        .icon {
            margin-left: 50px;
            position: absolute;
            margin-top: 23px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: bold;
            font-size: 23px;

        }
        
    </style>
</head>
<body>
    <div class="nav">
        <p id="playerOnline" class="playersOnline"></p>
        <p class="icon">BattleShips</p>
    </div>
    <main>
        <p>Create Game</p>
        <button id="createGame">Create game</button>
        <h1 id="gameId"></h1>
        <p>Or Join Game</p>
        <input placeholder="#xxxxxx" id="gameIdInput">
        <button id="joinGame">Join game</button>
        <ul id="messages"></ul>
        <div id="board" style="width: 400px; height: 400px;">
            
        </div>

    </main>     
    
    <script>
        let currentGame;
        let uuid;
        const socket = io();

        socket.on('playersOnlineUpdate', (playerCount) => {
                console.log("e")
                document.getElementById('playerOnline').innerHTML = playerCount + " Players Online"
        })
        socket.emit('requestPlayerCount', 0)

        document.addEventListener('DOMContentLoaded', () => {
            
            makeUUID();
            const gameId = document.getElementById('gameId');
            const createGame = document.getElementById('createGame');
            const joinGame = document.getElementById('joinGame');
            const input = document.getElementById('gameIdInput');
            const messages = document.getElementById('messages');

            // form.addEventListener('submit', (e) => {
            //     e.preventDefault();
            //     if (input.value) {
            //         socket.emit('chat message', input.value);
            //         input.value = '';
            //     }
            // });
            createGame.addEventListener('click', () => {
                socket.emit('requestGame', getUUID())
            })

            joinGame.addEventListener('click', () => {
                if (input.value != "") {
                    socket.emit("joinGame", [input.value, getUUID()])
                    input.value = ""
                }
            })

            socket.on('gameId', (msg) => {
                gameId.innerHTML = "#"+msg
            })

            socket.on('gameJoinedID', (msg) => {
                setCurrentGame(msg)

            })

            socket.on('yourGameJoined', (msg) => {
                if (msg.createdBy == getUUID()) {
                    console.log(msg)
                    setCurrentGame(msg)
                }
            })

            socket.on('opponentMove2', (move) => {
                if (move[0].player2 == getUUID()) {
                    console.log(move[1])
                    document.getElementById("block-"+move[1]).style.background = "red"
                }
            })

            socket.on('opponentMove1', (move) => {
                if (move[0].player1 == getUUID()) {
                    console.log(move[1])
                    document.getElementById("block-"+move[1]).style.background = "red"
                }
            })


            // socket.on('chat message', (msg) => {
            //     const item = document.createElement('li');
            //     item.textContent = msg;
            //     console.log(msg)
            //     messages.appendChild(item);
            //     window.scrollTo(0, document.body.scrollHeight);
            // }); 

        })


    </script>

    <script>

        const board = document.getElementById('board')

        function createBoard() {
            let x = 0;
            for (let i = 0; i < 10; i++) {
                const row = document.createElement('div')
                row.style.display = "flex";
                board.appendChild(row)
                for (let i = 0; i < 10; i++) {
                    x++;
                    const block = document.createElement('div')
                    block.classList.add('block')
                    block.id = "block-"+x
                    row.innerHTML = row.innerHTML + `<div class='block' id='block-${x}' onClick="attack('${x}')"></div>`
                }

            }
        }

        createBoard()

        function attack(x) {
            if (getCurrentGame() != undefined) {
                socket.emit('makeMove',[x, getCurrentGame(), getUUID()])
                document.getElementById("block-"+x).style.background = "blue"
            }
        }   

        function getUUID() {
            return uuid;
        }

        function makeUUID() {
            const UUID = Math.floor(Math.random() * 10000000000)
            uuid = UUID;
        }

        function setCurrentGame(id) {
            currentGame = id
        }

        function getCurrentGame() {
            return currentGame;
        }

        function generateRandomShips() {
            const randomU = Math.floor(Math.random()*100);  
            placeShip(randomU) 
        }

        function placeShip(i) {
            if (i % 10 == 0) {
                
            } else {

            }
        }

    </script>
</body>
</html>